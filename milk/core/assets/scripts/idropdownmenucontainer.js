/** * @author xuld */imports("Controls.Core.IDropDownMenuContainer");using("System.Dom.Align");/** * 所有支持下拉菜单的组件实现的接口。
 */var IDropDownMenuContainer = {		/**	 * 获取当前控件的下拉菜单。	 * @type Control	 * @property dropDownMenu
	 */		dropDownMenuWidth: 'auto',		onDropDownMenuOpen: function(){		this.trigger('dropdownmenuopen');	},		onDropDownMenuClose: function(){		this.trigger('dropdownmenuclose');	},	setDropDownMenu: function(control){				control = Dom.get(control);				// 设置下拉菜单。		this.dropDownMenu = control.addClass('x-dropdownmenu').hide();				// 如果当前节点已经添加到 DOM 树，则同时添加 control 。		if(!control.getParent('body')){						var tagName = this.dom.tagName;						// 给 div 和 span 更多关心。			if(tagName === 'DIV' || tagName === 'SPAN'){				Dom.movable(this.dom);				control.appendTo(this);			} else {				control.appendTo(this.getParent());			}						if(navigator.isQuirks && control.getParent().getStyle('z-index') === 0)				control.getParent().setStyle('z-index', 1);		}			},		realignDropDownMenu: function (offsetX, offsetY) {		this.dropDownMenu.align(this, 'bl', offsetX, offsetY);	},		toggleDropDownMenu: function(e){		if(e) this._dropDownMenuTrigger = e.target;		return this._dropDownMenuVisible ? this.hideDropDownMenu() : this.showDropDownMenu();	},		showDropDownMenu: function(){				if(this._dropDownMenuVisible){			return ;			}				this._dropDownMenuVisible = true;		this.dropDownMenu.show();		this.realignDropDownMenu(0, -1);				var size = this.dropDownMenuWidth;		if(size === 'auto') {			size = this.getSize().x;			if(size < Dom.styleNumber(this.dropDownMenu.dom, 'min-width'))				size = -1;		}				if(size !== -1) {			this.dropDownMenu.setSize(size);		}				this.onDropDownMenuOpen();				document.on('mouseup', this.dropDownMenuMouseUpHandler = Function.bind(this.hideDropDownMenu, this));	},		hideDropDownMenu: function (e) {				// 如果是来自事件的关闭，则检测是否需要关闭菜单。		if(e){			e = e.target;			if([this._dropDownMenuTrigger, this.dropDownMenu.dom, this.dom].indexOf(e) >= 0 || Dom.hasChild(this.dropDownMenu.dom, e) || Dom.hasChild(this.dom, e)) 				return;		}				this.onDropDownMenuClose();		this.dropDownMenu.hide();		document.un('mouseup', this.dropDownMenuMouseUpHandler);				this._dropDownMenuVisible = false;	}	};